<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/index}" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/select-box/latest/toastui-select-box.css" />
    <script src="https://uicdn.toast.com/select-box/latest/toastui-select-box.js"></script>
    <style>
        button {
            width: 100px;
            margin-right: 550px;
            border-radius: 20px;
        }
        .modal-header{
        	text-align: center;
        }

        #cenLbtn {
            margin-right: 20px;
        }

        h4 {
            text-align: center;
        }

        .tui-grid-cell-content {
            text-align: center;
        }
        
    </style>
</head>

<body>
    <th:block layout:fragment="content">
        <h4>전체 설비 리스트</h4>
        <div id="grid"></div>

        <!-- 모달 시작-->

        <button id="stopBtn" type="button" data-toggle="modal" data-target="#modal">비가동</button>

        <!-- Modal -->


        <!-- Modal -->
        <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">비가동 사유</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <!-- 드롭다운 -->

                        <!-- <div id="container"></div> -->
                        <div id="modalgrid"></div>
                        <!-- 드롭다운 끝 -->

                    </div>
                    <form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                        <button type="submit" class="btn btn-primary">추가</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- /.modal -->

        <h4>비가동 설비 리스트</h4>
        <div id="downgrid"></div>
        <div>
            <button type="submit">가동</button><button id="cenLbtn" type="submit">수정</button><button id="cenRbtn"
                type="submit">삭제</button>
        </div>
        
        <script>
        
            window.onload = function () {
                $.ajax({
                    url: "/Facilityajax",
                    method: "GET",
                    dataType: "JSON",
                    success: function (result) {
                        grid.resetData(result);
                    }
                });


                var grid = new tui.Grid({
                    el: document.getElementById('grid'),
                    scrollX: false,
                    scrollY: false,
                    data: {
                        api: {
                            readData: {
                                url: '/api/readData',
                                method: 'GET'
                            }
                        }
                    },
                    rowHeaders: ['checkbox'],
                    columns: [{
                        header: '설비명',
                        name: 'facName'
                    }, {
                        header: '설비 코드',
                        name: 'facCode'
                    }, {
                        header: '관리자',
                        name: 'facManager'
                    }, {
                        header: '설비 가동일시',
                        name: 'startDate'
                    }, {
                        header: '가동 상태',
                        name: 'facStatus',
                        filter: 'select'
                    }]
                });

                // 하단 시작


                $.ajax({
                    url: "/Downtimeajax",
                    method: "GET",
                    dataType: "JSON",
                    success: function (result) {
                        downgrid.resetData(result);
                    }
                });

                var downgrid = new tui.Grid({
                    el: document.getElementById('downgrid'),
                    scrollX: false,
                    scrollY: false,
                    rowHeaders: ['checkbox'],
                    columns: [{
                        header: '설비명',
                        name: 'facName'
                    }, {
                        header: '설비 코드',
                        name: 'facCode'
                    }, {
                        header: '비가동 코드',
                        name: 'downCode'
                    }, {
                        header: '비가동 사유',
                        name: 'downReason'
                    }, {
                        header: '설비 비가동일시',
                        name: 'stopDate'
                    }, {
                        header: '관리자',
                        name: 'downManager'
                    }]
                });                

                /* $('#stopBtn').hide(); 
				grid.on('uncheck', function () {
                    $('#stopBtn').hide();
                }); */
             
                

                /* 비가동 사유 드롭다운 */
                /* var SelectBox = tui.SelectBox;
                
                const container = document.getElementById('container');


                const selectBox = new SelectBox(container, {
                  data: [
                    {
                      label: '비가동 사유',
                      data: [ { label: '세척', value: '세척' }, { label: '정비', value: '정비' }, { label: '점검', value: '점검' } ]
                    }
                  ],
                  
                }); */



                /* console.log(selectBox.getSelectedItem().getLabel()); // 'Apple' */                
                
                
                /* 체크 한개만 */
                
                grid.on('check', function (e) {
                	var checkRows = grid.getCheckedRowKeys();
                	checkRows.forEach(function( key, idx){                		
                		if(key != e.rowKey){
                			grid.uncheck(key);
                		}
                	});
                });
                
                /* 체크 한개만 끝 */
                            
			
                /* 선택한 데이터 가져오기 */
                                
                $('#stopBtn').on('click', function () {
                	// console.log(grid.getCheckedRows());
                	 var sampleData = [ grid.getCheckedRows()[0] ]; 
                    
                	 class CustomTextEditor {
  				      constructor(props) {
  				        const el = document.createElement('input');
  				        const { maxLength } = props.columnInfo.editor.options;
  				
  				        el.type = 'text';
  				        el.maxLength = maxLength;
  				        el.value = String(props.value);
  				
  				        this.el = el;
  				      }
  				
  				      getElement() {
  				        return this.el;
  				      }
  				
  				      getValue() {
  				        return this.el.value;
  				      }
  				
  				      mounted() {
  				        this.el.select();
  				      }
  				    }
                  
                  var modalgrid = new tui.Grid({
                      el: document.getElementById('modalgrid'),
                      scrollX: false,
                      scrollY: false,
                      width:480,
                      data: sampleData,
                      rowHeight: 130,
                      columns: [
                     	 {
                              header: '설비명',
                              name: 'facName',
                              editor:'text',
                              width:70,
                              rowSpan: true 
                            },
                            {
                                header: '설비 코드',
                                name: 'facCode',
                                editor:'text',
                                width:70,
                                rowSpan: true 
                              },
                     	 
                     	 {
                          header: '비가동 사유',
                          name: 'facReason',
                          editor: {
                              type: 'select',
                              options: {
                                listItems: [
                                  { text: '세척', value: '세척' },
                                  { text: '정비', value: '정비' },
                                  { text: '점검', value: '점검' }
                                ]
                              }
                            },
                          width:90,
                          rowSpan: true 
                        },
                        {
                          header: '관리자',
                          name: 'downManager',
                          editor:'text',
                          width:70,
                          rowSpan: true 
                        },
                        {
                     	   header: '비고',
                            name: 'remark',
                            editor:'text',
                            width:180,
                            rowSpan: true,
                            whiteSpace: 'pre-wrap'
                        }
                      ]
                    });
                });
                
                /* 선택한 데이터 가져오기 끝*/
                               
                $(function () {
                     $('#modal').on('shown.bs.modal', function () {
                     	modalgrid.refreshLayout();
                     })
                 })
                                 
             

                 
            }
        </script>
    </th:block>
</body>

</html>