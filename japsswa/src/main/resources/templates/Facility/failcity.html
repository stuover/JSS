<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/index}" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

<style>
h2{
	text-align: center;
	margin-bottom: 15px;
}

.tui-grid-cell-content {
            text-align: center;
        }
</style>

</head>

<body>
    <th:block layout:fragment="content">
        <h2>설비 페이지</h2>
        
        <!-- 그리드 -->
        <div id="grid"></div>
        <!-- 그리드 끝-->
        
        <!-- 더블클릭시 모달 -->
        
        <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document" style="width:1200px">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="downModalTitle">비가동 내역</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                    
                    <!-- 그리드 -->
			        <div id="modalGrid"></div>
			        <!-- 그리드 끝-->
        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 더블클릭시 모달 끝-->
        
        <script>
        
        // 변수
        var dbGridData = null; 
        
        
        // 전체 설비 리스트 함수
        function getFacList(){
        	
        	$.ajax({
        		url : "/AllfacilityAjax",
        		method : "GET",
        		dataType : "JSON",
        		success : function(result){
        			grid.resetData(result);
        			console.log(result);
        		},
        		error : function(reject){
        			console.log("오류");
        			console.log(reject);
        		}
        	});
        }
        
        getFacList();
        
        const grid = new tui.Grid({
            el: document.getElementById('grid'),
            scrollX: false,
            scrollY: false,
            pageOptions: {
                useClient: true,
                perPage: 15
            },
            columns: [{
                    header: '설비코드 ',
                    name: 'facCode'
                },
                {
                    header: '설비명',
                    name: 'facName'
                },
                {
                    header: '설치날짜 ',
                    name: 'facDate'
                },
                {
                    header: '투입공정 ',
                    name: 'facProcess'
                },
                {
                    header: '설비가동상태 ',
                    name: 'facStatus',
                    validation: {
                    	 regExp: /[x-yX-Y]/
                      }
                },
                {
                    header: '세척주기 ',
                    name: 'washCycle'
                },
                {
                    header: '점검주기 ',
                    name: 'insCycle'
                },
                {
                    header: '마지막 점검일',
                    name: 'lastInspection'
                },
                {
                    header: '관리자',
                    name: 'facManager'
                },
                {
                    header: '설비기능',
                    name: 'facFunction'
                },
                {
                    header: '설비사진',
                    name: 'facPicture'
                }]
        });                        
        
        grid.on('dblclick', function (e) {
            
                dbGridData = grid.getRow(e.rowKey);
                console.log(dbGridData);

                grid.setSelectionRange({
                    start: [e.rowKey, 0],
                    end: [e.rowKey, grid.getColumns().length - 1]
                });

                $('#Modal').modal('show');
                modalGrid.resetData([dbGridData]);
            
        });
        
// ajax 

function getFacList2(){
        	
        	$.ajax({
        		url : "/AllfacilityAjax",
        		method : "GET",
        		dataType : "JSON",
        		success : function(result){
        			modalGrid.resetData(result);
        			console.log(result);
        		},
        		error : function(reject){
        			console.log("오류");
        			console.log(reject);
        		}
        	});
        }
        
        
        
        const modalGrid = new tui.Grid({
            el: document.getElementById('modalGrid'),
            scrollX: false,
            scrollY: false,
            pageOptions: {
                useClient: true,
                perPage: 15
            },
            columns: [{
                    header: '설비코드 ',
                    name: 'facCode'
                },
                {
                    header: '설비명',
                    name: 'facName'
                },
                {
                    header: '설치날짜 ',
                    name: 'facDate'
                },
                {
                    header: '투입공정 ',
                    name: 'facProcess'
                },
                {
                    header: '설비가동상태 ',
                    name: 'facStatus',
                    validation: {
                    	 regExp: /[x-yX-Y]/
                      }
                },
                {
                    header: '세척주기 ',
                    name: 'washCycle'
                },
                {
                    header: '점검주기 ',
                    name: 'insCycle'
                },
                {
                    header: '마지막 점검일',
                    name: 'lastInspection'
                },
                {
                    header: '관리자',
                    name: 'facManager'
                },
                {
                    header: '설비기능',
                    name: 'facFunction'
                },
                {
                    header: '설비사진',
                    name: 'facPicture'
                }]
        });
     
        </script>
        
    </th:block>
</body>

</html>