<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<th:block th:fragment="header">

	<nav class="navbar-breadcrumb col-xl-12 col-12 d-flex flex-row p-0">
		<div class="navbar-links-wrapper d-flex align-items-stretch">
			<div class="nav-link">
				<a href="javascript:;"><i class="typcn typcn-calendar-outline"></i></a>
			</div>
			<div class="nav-link">
				<a href="javascript:;"><i class="typcn typcn-mail"></i></a>
			</div>
			<div class="nav-link">
				<a href="javascript:;"><i class="typcn typcn-folder"></i></a>
			</div>
			<div class="nav-link">
			</div>

			<th:block sec:authorize="isAuthenticated()">
				<input th:value="${#authentication.principal.empName}">
				<div class="nav-link">
					<a href="#"><i class="typcn typcn-document-text"  id="openMyInfo"></i></a>
				</div>
				<div class="nav-link">
					<form th:action="logout" method="post">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
						<button>로그아웃</button>
					</form>
				</div>

			</th:block>
			
		</div>
	</nav>
	
<th:block sec:authorize="isAuthenticated()">
	<div class="modal fade" id="myInfo" tabindex="-1" aria-labelledby="exampleModalLabel" >
	        <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	        <form id="myFom">
	            <div class="modal-header">
	            <h5 class="modal-title" id="searchModalLabel">내정보</h5>
	            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
		            <div class="modal-body">
		          
		            	<span>사원번호 : </span><input id="empNo" name="empNo" th:value="${#authentication.principal.empNo}" readonly><br>
						<span>사원이름 : </span><input th:value="${#authentication.principal.empName}" readonly><br>
						<span>부서이름 : </span><input th:value="${#authentication.principal.deptName}" readonly><br>
						<span>  직 책 : </span><input th:value="${#authentication.principal.position}" readonly><br>
						
						<span>전화번호 : </span><input id="phoneNum" name="phoneNum" th:value="${#authentication.principal.phoneNum}" placeholder="연락처"><br>
						<span> 이메일 : </span><input id="email" name="email" th:value="${#authentication.principal.email}"  type= "email" placeholder="e-mail"><br>
						<span>새비밀번호 : </span><input id="newPwd" name="newPwd" type="password" placeholder="새 비밀번호"><br>
						<span id="message" style="display:none"> 비밀번호가 다릅니다.</span>
						<span>비밀번호확인 : </span><input id="newPwd2" name="newPwd2" type="password" placeholder="새 비밀번호 확인"><br>
		            </div>
	            <div class="modal-footer">
	            	<input id="password" name="password" type="password" placeholder="현재 비밀번호"><br>
	            	<button id="myInfoModBtn" type="button" class="btn btn-primary">수정</button>
	            </div>
	        </form>
	        </div>
	        </div>
	    </div>

</th:block>
	<script>
	const token = $("meta[name='_csrf']").attr("content")
	const header = $("meta[name='_csrf_header']").attr("content");

	$('#openMyInfo').on('click', function(e){
		e.preventDefault();
		$('#myInfo').modal('show');
	})
	
	$('#modPwBtn').on('click', function(){
		$('#newPwdInp').css('display', "block")
	})
	
	$('#myFom #myInfoModBtn').on('click', function(e){
		let pwd = $('#password').val();
		console.log(pwd);

		if(pwd != null && pwd!=""){
			let newPwd = $('#newPwd').val();
			let newPwd2 = $('#newPwd2').val();
			console.log(newPwd)
						console.log(newPwd2)

			if(newPwd == newPwd2){
				$.ajax({
					url : "/modifyPwd",
					method:"post",
					contentType : "application/json",
					data : JSON.stringify({password : pwd,
							phoneNum : $("#phoneNum").val(),
							email : $("#email").val(),
							newPwd : $("#newPwd").val()}),
					beforeSend: function(xhr){
						xhr.setRequestHeader(header, token);    
					},
					success : function(result){
						if(result == "success"){
							alert("내정보가 수정 되었습니다.")
							$('#myFom newPwd').val('');
							$('#myFom newPwd2').val('');
							$('#myFom password').val('');
							$('#myInfo').modal('hide');

						}else if(result == "fail"){
							alert("비밀번호가 틀렸습니다.")
							$('#myFom newPwd').val('');
							$('#myFom newPwd2').val('');
							$('#myFom password').val('');
						}						
					},error : function(reject){
						console.log(reject)
					}
				})
			}else {
				$('#myFom newPwd').val('');
				$('#myFom newPwd2').val('');
				$('#myFom password').val('');	
				$('#message').css("display","block");
				
			}
			
		}else {
			alert('현재 비밀번호를 입력하세요!')
		}
	})


	</script>
	
	<!-- <div class="container-fluid page-body-wrapper">

		
		<div id="right-sidebar" class="settings-panel">
			<i class="settings-close typcn typcn-times"></i>
			<ul class="nav nav-tabs" id="setting-panel" role="tablist">
				<li class="nav-item"><a class="nav-link active" id="todo-tab"
					data-toggle="tab" href="#todo-section" role="tab"
					aria-controls="todo-section" aria-expanded="true">TO DO LIST</a></li>
				<li class="nav-item"><a class="nav-link" id="chats-tab"
					data-toggle="tab" href="#chats-section" role="tab"
					aria-controls="chats-section">CHATS</a></li>
			</ul>
			<div class="tab-content" id="setting-content">
				<div class="tab-pane fade show active scroll-wrapper"
					id="todo-section" role="tabpanel" aria-labelledby="todo-section">
					<div class="add-items d-flex px-3 mb-0">
						<form class="form w-100">
							<div class="form-group d-flex">
								<input type="text" class="form-control todo-list-input"
									placeholder="Add To-do">
								<button type="submit"
									class="add btn btn-primary todo-list-add-btn" id="add-task">Add</button>
							</div>
						</form>
					</div>
					<div class="list-wrapper px-3">
						<ul class="d-flex flex-column-reverse todo-list">
							<li>
								<div class="form-check">
									<label class="form-check-label"> <input
										class="checkbox" type="checkbox"> Team review meeting
										at 3.00 PM
									</label>
								</div> <i class="remove typcn typcn-delete-outline"></i>
							</li>
							<li>
								<div class="form-check">
									<label class="form-check-label"> <input
										class="checkbox" type="checkbox"> Prepare for
										presentation
									</label>
								</div> <i class="remove typcn typcn-delete-outline"></i>
							</li>
							<li>
								<div class="form-check">
									<label class="form-check-label"> <input
										class="checkbox" type="checkbox"> Resolve all the low
										priority tickets due today
									</label>
								</div> <i class="remove typcn typcn-delete-outline"></i>
							</li>
							<li class="completed">
								<div class="form-check">
									<label class="form-check-label"> <input
										class="checkbox" type="checkbox" checked> Schedule
										meeting for next week
									</label>
								</div> <i class="remove typcn typcn-delete-outline"></i>
							</li>
							<li class="completed">
								<div class="form-check">
									<label class="form-check-label"> <input
										class="checkbox" type="checkbox" checked> Project
										review
									</label>
								</div> <i class="remove typcn typcn-delete-outline"></i>
							</li>
						</ul>
					</div>
					<div class="events py-4 border-bottom px-3">
						<div class="wrapper d-flex mb-2">
							<i class="typcn typcn-media-record-outline text-primary mr-2"></i>
							<span>Feb 11 2018</span>
						</div>
						<p class="mb-0 font-weight-thin text-gray">Creating component
							page</p>
						<p class="text-gray mb-0">build a js based app</p>
					</div>
					<div class="events pt-4 px-3">
						<div class="wrapper d-flex mb-2">
							<i class="typcn typcn-media-record-outline text-primary mr-2"></i>
							<span>Feb 7 2018</span>
						</div>
						<p class="mb-0 font-weight-thin text-gray">Meeting with Alisa</p>
						<p class="text-gray mb-0 ">Call Sarah Graves</p>
					</div>
				</div>
				To do section tab ends
				<div class="tab-pane fade" id="chats-section" role="tabpanel"
					aria-labelledby="chats-section">
					<div
						class="d-flex align-items-center justify-content-between border-bottom">
						<p
							class="settings-heading border-top-0 mb-3 pl-3 pt-0 border-bottom-0 pb-0">Friends</p>
						<small
							class="settings-heading border-top-0 mb-3 pt-0 border-bottom-0 pb-0 pr-3 font-weight-normal">See
							All</small>
					</div>
					<ul class="chat-list">
						<li class="list active">
							<div class="profile">
								<img src="images/faces/face1.jpg" alt="image"><span
									class="online"></span>
							</div>
							<div class="info">
								<p>Thomas Douglas</p>
								<p>Available</p>
							</div> <small class="text-muted my-auto">19 min</small>
						</li>
						<li class="list">
							<div class="profile">
								<img src="images/faces/face2.jpg" alt="image"><span
									class="offline"></span>
							</div>
							<div class="info">
								<div class="wrapper d-flex">
									<p>Catherine</p>
								</div>
								<p>Away</p>
							</div>
							<div class="badge badge-success badge-pill my-auto mx-2">4</div>
							<small class="text-muted my-auto">23 min</small>
						</li>
						<li class="list">
							<div class="profile">
								<img src="images/faces/face3.jpg" alt="image"><span
									class="online"></span>
							</div>
							<div class="info">
								<p>Daniel Russell</p>
								<p>Available</p>
							</div> <small class="text-muted my-auto">14 min</small>
						</li>
						<li class="list">
							<div class="profile">
								<img src="images/faces/face4.jpg" alt="image"><span
									class="offline"></span>
							</div>
							<div class="info">
								<p>James Richardson</p>
								<p>Away</p>
							</div> <small class="text-muted my-auto">2 min</small>
						</li>
						<li class="list">
							<div class="profile">
								<img src="images/faces/face5.jpg" alt="image"><span
									class="online"></span>
							</div>
							<div class="info">
								<p>Madeline Kennedy</p>
								<p>Available</p>
							</div> <small class="text-muted my-auto">5 min</small>
						</li>
						<li class="list">
							<div class="profile">
								<img src="images/faces/face6.jpg" alt="image"><span
									class="online"></span>
							</div>
							<div class="info">
								<p>Sarah Graves</p>
								<p>Available</p>
							</div> <small class="text-muted my-auto">47 min</small>
						</li>
					</ul>
				</div>
				chat tab ends
			</div>
		</div> -->
</th:block>

</html>

