<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/index}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />



<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.js"></script>

<style>
	
</style>

</head>
<body>





<th:block layout:fragment="content">
	
	
	<h3 style="font-weight:bold; margin-left:30px;">자재 발주 조회</h3>
	


<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="grid2"></div>
      </div>
      <div class="modal-footer">
        <button type="button"id= "closeBtn" data-bs-dismiss="modal" class="btn btn-secondary">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
	
	
	
	<div id="grid" style="margin-top:100px;"></div>
	
	
	<div id="grid1"></div>
	
	<script>
	
	$(document).ready(function(){
		
	
	$.ajax({
				url : "/mrOrderListAjax",

				method : "GET",
				dataType : "json",

				success : function(result) {
					grid1.resetData(result);
					
				},
				error:function(reject){
					console.log(reject);
				}

			});

			var grid1 = new tui.Grid({
				el : document.getElementById('grid1'),
				scollX : false,
				scollY : false,
				
				rowHeaders: ['checkbox'],
				
				columns : [ 
					{
						header : '발주일자',
						name : 'mrOrderDate'
					},
					{
					header : '발주코드',
					name : 'mrOrderCode'
				}, 
					{
					header : '거래처코드',
					name : 'customerId'
				}, 
				{
					header : '거래처명',
					name : 'customerName'
				},
				
				{
					header : '사원 코드',
					name : 'empNo'
				}, 
				{
					header : '사원명',
					name : 'empName'
				},
				{
					header : '품목 수',
					name : 'productCount'
				},				
				{
					header : '총 가격',
					name : 'allCount'
				} 
				
				],
				pageOptions: { 
	            	useClient: true,
	               	perPage: 5 
	            }
			})
			
	
	
			
	grid1.on('dblclick',(ev) =>{
		
				if(ev.columnName=='mrOrderCode'){
					$('#exampleModalLong').modal('show');
							
				
				
				
				
				let result= grid1.getRow(ev.rowKey);
				console.log(result.mrOrderCode);
			
			
			
			console.log(result.mrOrderCode);
			
			$.ajax({
				url : "/mrOrderDetailAjax",

				method : "GET",
				dataType : "json",
				data : {'result':result.mrOrderCode},
				
				success : function(result) {
					grid2.resetData(result);
					
					
				},
				error:function(reject){
					console.log(reject);
				}

			});
				}
			});	
			
			
					
			var grid2 = new tui.Grid({
				el : document.getElementById('grid2'),
				scollX : false,
				scollY : false,
				
				rowHeaders: ['checkbox'],
				
				columns : [{
					header : '발주 일자',
					name : 'mrOrderDate'
				} , {
					header : '발주 코드',
					name : 'mrOrderCode'
				}, {
					header : '발주 상세코드',
					name : 'mrOrderDetCode'
				},
				{
					header : '담당자',
					name : 'empName'
				},
				{
					header : '거래처 코드',
					name : 'customerId'
				},
				{
					header : '거래처명',
					name : 'customerName'
				},
				{
					header : '품목 코드',
					name : 'itemCode'
				},
				{
					header : '품목명',
					name : 'itemName'
				},
				{
					header : '수량',
					name : 'mrCount'
				}, 
				{
					header : ' 가격',
					name : 'mrPrice'
				},
				{
					header : '총 가격',
					name : 'priceTotal'
				},
				{
					header : '납품일',
					name : 'deliveryDate'
				}
				
				],
				
			})	
			
			
			
			$(function(){
		    	$('#exampleModalLong').on('shown.bs.modal', function(){
		    		grid2.refreshLayout();
		    	})
		    })
			
			
		});

	
		</script>
	
	
	

</th:block>


</body>

</html>	