
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/index}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.js"></script>

<style>
</style>

</head>
<body>

	<th:block layout:fragment="content">
		<h3 style="font-weight: bold; margin-top:50px; text-align:center; margin-right:40px;">&emsp;자재 입고</h3>

		<form action="/test" method="post">
		<div>
			<button type="button" id="storeBtn" class="btn btn-success"
				data-bs-toggle="modal" data-bs-target="#searchModal"
				style="float: right; height: 30px; width: 50px; padding: 8px; margin-bottom: 10px; margin-right: 20px; margin-top:90px;">입고</button>
				<input type="hidden" value="" id="sotre" name="testCode">
			<button type="button" id="checkBtn" class="btn btn-primary"
				data-toggle="modal" data-target=".bd-example-modal-lg"
				data-bs-target="#searchModal"
				style="float: right; height: 30px; width: 80px; padding: 8px; margin-bottom: 10px; margin-right: 8px; margin-top:90px;">입고확인</button>

		</div>
		</form>


		<!-- Large modal -->


		<div class="modal fade bd-example-modal-lg" id="store" tabindex="-1"
			role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">

			<div class="modal-dialog modal-lg">

				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="exampleModalLabel"
							style="font-weight: bold; margin-left: 750px;">입고 처리 확인</h4>

						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>

					</div>
					<div>
						<h6 style="font-weight: bold; text-align: center;">
							입고사유코드 :<input type=text id="searchcode"
								style="margin-left: 15px; padding: 1px;">
							<button type="button" class="btn btn-dark" id="searchBtn"
								style="padding: 8px; margin-left: 15px;">검색</button>
						</h6>
					</div>
					<div id="grid1"></div>
					<div>
						<button type="button" id="closeBtn" class="btn btn-dark" data-dismiss="modal"
							style="width: 50px; height: 30px; margin-left: 830px; padding: 8px;">닫기</button>
					</div>
				</div>

			</div>
		</div>


		<div id="grid" ></div>


		<script>
		
		const token = $("meta[name='_csrf']").attr("content")
  		const header = $("meta[name='_csrf_header']").attr("content");
		
		
		$(document).ready(function() {
			
			
			$('#storeBtn').on('click',function(){
		    	console.log(grid.getCheckedRows()[0].testCode);

		    	$.ajax({
		    		url : "/mrStore",
		    		contentType: "application/json",
					method : "POST",
					data : JSON.stringify({testCode : grid.getCheckedRows()[0].testCode}),
					dataType : "json",
					beforeSend: function(xhr){
						xhr.setRequestHeader(header, token);
					},
					success : function(result) {
					}
		    	})
				grid.removeCheckedRows(false);

		    	
		    })
			
			
			
			
			
			
			
			
			$.ajax({
				url : "/mrlistAjax",

				method : "GET",
				dataType : "json",

				success : function(result) {
					grid.resetData(result);
					
				}

			});

			var grid = new tui.Grid({
				el : document.getElementById('grid'),
				scollX : false,
				scollY : false,
				
				rowHeaders: ['checkbox'],
				
				
				columns : [ {
					header : '검사코드',
					name : 'testCode'
				}, {
					header : '품목코드',
					name : 'itemCode'
				}, {
					header : '주문 상세 코드',
					name : 'mrOrderDetail'
				}, {
					header : '상태',
					name : 'situation'
				}, {
					header : '검사 시작일',
					name : 'startDate'
				}, 
				{
					header : '검사 완료일',
					name : 'endDate'
				},
				{
					header : '사원번호',
					name : 'empNo'
				},
				{
					header : '검사량',
					name : 'testQuantity'
				},
				{
					header : '불량량',
					name : 'errQuantity'
				},
				{
					header : '합격량',
					name : 'passQuantity'
				},
				{
					header : '불량률',
					name : 'defectiveRate'
				},
				{
					header : '비고',
					name : 'testNote'
				}
				
				]
			})
			
		
		


		
			
		
		
		
		$.ajax({
			url : "/mslistAjax",
			method : "GET",
			dataType : "json",
			success : function(result) {
				modalgrid.resetData(result);
				modalgrid.refreshLayout();
			}

		});

		var modalgrid = new tui.Grid({
			el : document.getElementById('grid1'),
			scollX : false,
			scollY : false,	
			columns : [ {
				header : '자재lot번호',
				name : 'mrLotNumber',
				
			}, {
				header : '품목코드',
				name : 'itemCode'
			},{
				header : '사원 번호',
				name : 'empNo'
			},  
			{
				header : '입고 날짜',
				name : 'storeDate'
			}, {
				header : '입고 수량',
				name : 'storeCount'
			},
			{
				header : '홀드수량',
				name : 'holdCount'
			},
			{
				header : '유통기한',
				name : 'expireDate'
			},
			{
				header : '입고 사유 구분',
				name : 'storeReasonType'
			},
			{
				header : '입고 사유 코드',
				name : 'storeReasonCode'
			}
			
			
			]
		})
	
		
		
		
		
		
		
		
		$('#searchBtn').on('click',function(){
			  
			  const result= $("#searchcode").val();
			  $('#searchcode').val('');
				
			  $.ajax({
					url:"/searchListAjax",
					method:"GET",
					data:{'result':result},
					dataType:"json",
				
				success : function(result) {
					modalgrid.resetData(result);
					modalgrid.refreshLayout();
					console.log(result);
				}
				
					
		     });
			  
			 $('#closeBtn').on('click',function(){
				 $.ajax({
						url : "/mslistAjax",
						method : "GET",
						dataType : "json",
						success : function(result) {
							modalgrid.resetData(result);
						}

					});
				})
 
			 }) 		
		
			
			
		
		
		$(function(){
	    	$('#store').on('shown.bs.modal', function(){
	    		modalgrid.refreshLayout();
	    	})
	    })
	   
	   
	    
		});
	</script>








	</th:block>


</body>

</html>

