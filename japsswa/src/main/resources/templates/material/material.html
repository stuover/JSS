<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/index}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />

<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.js"></script>

<style>



#grid .redcolor{
	background-color:#ffe4e4;
}

#grid .yellowcolor{
	background-color:yellow;
}	
</style>

</head>
<body>

<th:block layout:fragment="content">
	
 		<div class="container-fluid page-body-wrapper">

 			<div class="col-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  
					<h3 style="font-weight:bold; margin-left:700px; margin-bottom:30px;">&ensp;자재 재고 조회</h3>
						
						<div class="btn-group">
						   <!-- Button trigger modal -->
						<button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModal">
						  버튼
						</button>
						</div>
		
		<!--  제목 -->		<!-- 검색 버튼 --> 
		
		
		<h5 style="font-weight:bold; margin-top:20px; margin-left:500px;">&ensp;자재 재고 검색 &emsp;:&emsp; <input type=text id="mrName"> <button type="button" class="btn btn-dark" id="searchBtn"
																style="padding: 3px; margin-left: 15px;">검색</button></h5>
			 <!-- 검색 화면  그리드 -->
			 	
						<div id="searchGrid">
			 
			 <!-- 재고 화면 그리드 -->			
						
							<div id="grid3"></div>
						</div>
						<div id="hide">
							<div id="grid" style="margin-top: 20px;"></div>
						</div>
						<div id="grid1" ></div>
						
						<h3 style="font-weight:bold; margin-left:680px; margin-top:40px; margin-bottom:40px;">&ensp;lot별 자재 조회</h3>
						<div id="grid4" style="margin-top:20px;"></div>
			
						
					
					<!-- Modal -->
					
					<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
					  <div class="modal-dialog" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">&times;</span>
					        </button>
					      </div>
					      <div class="modal-body">
					        ...
					      </div>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					        <button type="button" class="btn btn-primary">Save changes</button>
					      </div>
					    </div>
					  </div>
					</div>             
				            
                </div>
              
              </div>
            </div>

  		</div>
  		
		
  		
	
	
	
	
	
	<script>
	
	
	
	
		
	// 재고 아작스
	
		window.onload = function(){
		
	
		
			$('#searchGrid').css('display', 'none');
			
			$.ajax({
				url : "/mrCount",
				method : "GET",
				success : function(result) {
					
					grid.resetData(result);
					let data3 = grid.getData();
					console.log(grid.getData());
					grid.getData().forEach((ele, index)=>{
						
					console.log(ele.total);
					console.log(ele.saveMaterial);
					console.log(index);
						
						if( Number(ele.total) < Number(ele.saveMaterial)){
							grid.addCellClassName(index,'itemType','redcolor');
							grid.addCellClassName(index,'itemName','redcolor');
							grid.addCellClassName(index,'itemCode','redcolor');
							grid.addCellClassName(index,'total','redcolor');
							grid.addCellClassName(index,'saveMaterial','redcolor');
						} else if( Number(ele.total) <= Number(ele.saveMaterial/2) ){
							grid.addCellClassName(index,'itemType','yellowcolor');
							grid.addCellClassName(index,'itemName','yellowcolor');
							grid.addCellClassName(index,'itemCode','yellowcolor');
							grid.addCellClassName(index,'total','yellowcolor');
							grid.addCellClassName(index,'saveMaterial','yellowcolor');
							
							
						}
							
			

			
			
					
				
					} ) 

				},

				error: function(reject){
					console.log(reject);
				}

			
		});
	// 재고 그리드
		
			var grid = new tui.Grid({
				el : document.getElementById('grid'),
				scollX : false,
				scollY : false,
				
				
				columns : [ {
					header : '구분',
					name : 'itemType'
				},
					{
					header : '품목코드',
					name : 'itemCode'
				}, {
					header : '자재명',
					name : 'itemName'
				},
				{
					header : '재고량',
					name : 'total'
				},
				{
					header : '안전재고',
					name : 'saveMaterial'
				}
				
				
				],
				pageOptions: { 
	            	useClient: true,
	               	perPage: 4
	            }
			})
	
	
	
			
		
		
		
	// 검색 결과 그리드	
		
		
		var grid3 = new tui.Grid({
			el : document.getElementById('grid3'),
			scollX : false,
			scollY : false,
			
			
			columns : [ {
				header : '자재명',
				name : 'itemName',
				
			}, {
				header : '구분',
				name : 'itemType'
			}, {
				header : '재고량',
				name : 'total'
			}
			
			
			],
			pageOptions: { 
            	useClient: true,
               	perPage: 4 
            }
			
		})
	
	
		
		
	// 검색 결과 아작스
		
		$('#searchBtn').on('click',function(){
			  
			$('#hide').css('display', 'none');
			$('#searchGrid').css('display', 'block');
				
			  const result1= $("#mrName").val();
			  $('#mrName').val('');
				
			  $.ajax({
					url:"/mrCountAjax",
					method:"GET",
					data:{'result':result1},
					dataType:"json",
				success : function(result) {
					grid3.resetData(result);
					grid3.refreshLayout();
					
				}
				
					
		     });
			})
			
	
	// 자재 lot 재고
	
		$.ajax({
			url:"/mrLotCount",
			method:"GET",
			success: function(result){
				grid4.resetData(result);
			},
			error: function(reject){
				console.log(reject)
			}
		})
		
	
		
		var grid4 = new tui.Grid({
			el : document.getElementById('grid4'),
			scollX : false,
			scollY : false,
			
			
			columns : [ {
				header : '자재lot번호',
				name : 'mrLotNumber',
				
			}, {
				header : '자재명',
				name : 'itemName'
			}, {
				header : '구분',
				name : 'itemType'
			},{
				header : '재고량',
				name : 'total'
			},{
				header : '유통기한',
				name : 'expireDate'
			}
			
			
			
			],
			pageOptions: { 
            	useClient: true,
               	perPage: 5 
            }
		})
		
			
			
			
		
			
			
	// 새로고침 	
		
		$(function(){
	    	$('#store').on('shown.bs.modal', function(){
	    		grid.refreshLayout();
	    	})
	    });
	   
	    
			
	};
		
	    
	</script>

	
	
	
	
	
	





</th:block>


</body>

</html>