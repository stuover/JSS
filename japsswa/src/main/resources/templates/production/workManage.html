<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/index}"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<th:block layout:fragment="content">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">

<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>


<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	
 		<div class="container-fluid page-body-wrapper">
 			<div class="col-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                <!-- Body Start -->
                
                  <h4 class="page-title">작업 지시 관리</h4>
                  
                  <input id="afterSearch" type="hidden" name="selectResult" value="insert">
                  <input id="empName" type="hidden" th:value="${#authentication.principal.empName}">

                  <div class="m-3 d-grid gap-2 d-md-flex justify-content-md-end">
                  	<button type="button" id="searchBtn" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#searchModal">조회</button>
                  	<button id="saveBtn" class="btn btn-primary">저장</button>
                  	<button id="deleteBtn" class="btn btn-danger">삭제</button>
                  </div>
                  
                  
				<div class="p-2 row">
				  <div class="col-sm-12">
				    <div class="card">
				      <div class="card-body">
				      <!-- card-body start -->
				        
	                  <div id="commonGrid"></div>
	                  
	                  <div id="detailGrid"></div>
				        
					  <!-- card-body end -->
				      </div>
				    </div>
				  </div>
				</div>       
                  
				<div class="p-2 row">
				  <div class="col-sm-4">
				    <div class="card">
				      <div class="card-body">
				      <!-- card-body start -->
				        <h5 class="page-title">공정</h5>
				        <div id="processGrid"></div>
					  <!-- card-body end -->
				      </div>
				    </div>
				  </div>
				  <div class="col-sm-8">
				    <div class="card">
				      <div class="card-body">
				      <!-- card-body start -->
				        <h5 class="page-title">홀드 자재</h5>
				        <div id="holdGrid"></div>
				        
					  <!-- card-body end -->
				      </div>
				    </div>
				  </div>
				</div>     
                  
                  
                  
                  
				<!-- Body End -->				            
                </div>
              </div>
            </div>
  		</div>
  		
		
  		
	    <div class="modal fade" id="" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	            <div class="modal-header">
	            <h5 class="modal-title" id="searchModalLabel">생산계획 조회</h5>
	            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
		            <div class="modal-body">
		            
			            <input type="date" id=""></input> ~ <input type="date" id=""></input>
			            <button id="">검색</button>
			            <div id=""></div>
		            
		            </div>
	            <div class="modal-footer">
	            <button id="" type="button" class="btn btn-primary">선택</button>
	            </div>
	        </div>
	        </div>
	    </div>
	    
	    <div class="modal fade" id="" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	            <div class="modal-header">
	            	<h5 class="modal-title" id="searchModalLabel">작업지시 조회</h5>
	            	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
			    	<input type="date" id=""></input> ~ <input type="date" id=""></input>
			    	<button id="">검색</button>
			    	<div id=""></div>
	            </div>
	            <div class="modal-footer">
	            	<button id="" type="button" class="btn btn-primary">선택</button>
	            </div>
	        </div>
	        </div>
	    </div>	    
  		

  		<script>
  		const token = $("meta[name='_csrf']").attr("content")
  		const header = $("meta[name='_csrf_header']").attr("content");
  		
  		
	  	// 작업 지시 공통(초기화면)
		let commonGridData = [{}];
		const commonGrid = new tui.Grid({
			el: document.getElementById('commonGrid'),
			data: commonGridData,
			scrollX: false,
			scrollY: false,
			columns: [
				{
		          header: '계획코드',
		          name: 'planId'
		        },
		        {
		          header: '계획명',
		          name: 'planName'
		        },
		        {
		          header: '지시명',
		          name: 'workName',
				  editor: 'text'
		        },
		        {
		          header: '지시날짜',
		          name: 'workDate',
				  formatter: function (e) {
					let result = e.value;
					if(result == null) {
						result = e.value;
						return;
					} else {
						result = e.value.substr(0,10);
						return;
					}
				  },
				  editor: 'datePicker'
		        },
		        {
		          header: '담당자',
		          name: 'empName'
		        }
		      ]
		    });
  		
  
  		    
  		// 생산계획 상세(초기회면)
		let detailGridData = [{}];
		const detailGrid = new tui.Grid({
		el: document.getElementById('detailGrid'),
		data: detailGridData,
		rowHeaders: ['checkbox'],
		scrollX: false,
		scrollY: false,
		columns: [
			{
		     	header: '세부지시 코드',
		    	name: 'wdetailId',
		    	hidden: true
		     },
		     {
		        header: '제품코드',
		        name: 'itemCode'
		      },
		      {
		        header: '제품명',
		        name: 'itemName',
				editot: 'text'
		      },
		      {
		        header: '계획수량',
		        name: 'planAmount'
		      },
		      {
		        header: '지시 시작날짜',
		        name: 'workStart',
				formatter: function (e) {
					let result = e.value;
					
					if(result == null) {
						result = e.value;
						return;
					} else {
						result = e.value.substr(0,10);
						return;
					}
				 },
				editor: 'datePicker'
		      },
			  {
		        header: '지시 완료날짜',
		        name: 'workEnd',
				formatter: function (e) {
					let result = e.value;
					if(result == null) {
						result = e.value;
						return;
					} else {
						result = e.value.substr(0,10);
						return;
					}
			  },
				editor: 'datePicker'
		      },
		      {
		        header: '지시수량',
		        name: 'workAmount',
				editor: 'text'
		      }
		     ]
		   });
  		    
			// 그리드 edit 시작 -> checkBox : checked
			detailGrid.on('editingStart', (e) => { detailGrid.check(e.rowKey)}) 		
  			
			
			// 공정 정보
			let processGridData = [{}];
		    const processGrid = new tui.Grid({
		      el: document.getElementById('processGrid'),
		      data: processGridData,
		      rowHeaders: ['checkbox'],
		      scrollX: false,
		      scrollY: true,
		      columns: [
		        {
		          header: '공정코드',
		          name: 'proCode;'
		        },
		        {
		          header: '공정명',
		          name: 'proName'
		        },
		        {
		          header: '공정순서',
		          name: 'proSeq'
		        }
		      ]
		    });			
			
			// Hold 자재 정보
			let holdGridData = [{}];
		    const holdGrid = new tui.Grid({
		      el: document.getElementById('holdGrid'),
		      data: holdGridData,
		      rowHeaders: ['checkbox'],
		      scrollX: false,
		      scrollY: true,
		      columns: [
		        {
		          header: '제품코드',
		          name: 'itemCode',
				  hidden: true
		        },
		        {
		          header: '제품명',
		          name: 'itemName'
		        },
		        {
		          header: '자재LOT',
		          name: 'mrLotNumber'
		        },   
		        {
		          header: '현 재고',
		          name: 'column6'
		        },
		        {
		          header: '소요량',
		          name: 'itemCon'
		        },
		        {
		          header: 'Hold 자재 코드',
		          name: 'holdId',
				  hidden: true
		        },		
		        {
		          header: 'Hold 수량',
		          name: 'holdAmount',
				  editor: 'text'
		        },
				{
		          header: 'Hold 상태',
		          name: 'holdStatus',
				  editor: 'text'
		        }
		      ]
		    });
  			
		

			
  		</script>
    
	</th:block>

</html>