<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/index}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head lang="en">
<meta charset="UTF-8">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">


<script type="text/javascript"
	src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<link rel="stylesheet"
	href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<link rel="stylesheet"
	href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script
	src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>


<th:block layout:fragment="content">
	<div class="container-fluid page-body-wrapper">
		<div class="col-12 grid-margin stretch-card">
			<div class="card">
				<div class="card-body">
					<h1 class="card-title">품목 정보</h1>
					
					<select id="item">
						<option value="null">전체</option>
						<option th:each="list : ${list}" th:text="${list.detaName}" th:value="${list.detaCode}">fdd</option>
					</select>
					
					<input id="search" name="search" type="text" >
					<button id="insertBtn" type="button" class="btn btn-primary">검색</button>
						<div id="grid"></div>
					<button id="addModalBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">등록</button>
					<button id="modModalBtn" type="button" class="btn btn-primary"  >수정</button>
					
					
				</div>
			</div>
		</div>
	</div>
	
	
		 <div class="modal fade" id="addModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="searchModal" aria-hidden="true">
	        <div class="modal-dialog modal-lg modal-dialog-centered" style ="width:670px;">
	        <div class="modal-content">
	            <div class="modal-header">
	            <h5 class="modal-title" style="padding-right:25px;">품목 등록</h5>
	                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>

				<div id="modal-body">
					<div id="modalGrid"></div>
				</div>

	            <div class="modal-footer">
	            	<button id="addBtn" type="button" class="btn btn-primary">등록</button>
	            </div>
	        </div>
	        </div>
	    </div>
	    
	    
	     <div class="modal fade" id="modModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="searchModal" aria-hidden="true">
	        <div class="modal-dialog modal-lg modal-dialog-centered" style ="width:670px;">
	        <div class="modal-content">
	            <div class="modal-header">
	            <h5 class="modal-title" style="padding-right:25px;">품목 수정</h5>
	                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>

				<div id="modal-body">
					<div id="modModalGrid"></div>
				</div>

	            <div class="modal-footer">
	            	<button id="modBtn" type="button" class="btn btn-primary">수정</button>
	            	<button id="delBtn" type="button" class="btn btn-primary">삭제</button>
	            	
	            </div>
	        </div>
	        </div>
	    </div>
	
	
<script>

const token = $("meta[name='_csrf']").attr("content")
const header = $("meta[name='_csrf_header']").attr("content");

var grid = new tui.Grid({
	el : document.getElementById('grid'),
	scrollX : true,
	scrollY : true,
	rowHeaders : [ {type : 'checkbox', header:" "},{type :'rowNum'} ],
	pageOptions : {
		useClient : true,
		perPage : 10
	},
	columns : [ 
	{
		header : '품목코드',
		name : 'itemCode',
		width: 100,
		sortingType : 'desc',
		sortable : true
	}, {
		header : '품목명',
		name : 'itemName',
		sortingType : 'desc',
		sortable : true
	}, {
		header : '구분',
		name : 'itemType',
		sortingType : 'desc',
		sortable : true,
	}, {
		header : '규격',
		name : 'standard',
		sortingType : 'desc',
		sortable : true
	}, {
		header : '단위',
		name : 'unit',
		sortingType : 'desc',
		sortable : true
	}, {
		header : '단가',
		name : 'unitPrice',	
		sortingType : 'desc',
		sortable : true
	}, {
		header : '판매가격',
		name : 'itemPrice',
		sortingType : 'desc',
		sortable : true
	}, {
		header : '안전재고',
		name : 'saveMaterial',
		sortingType : 'desc',
		sortable : true
	}
	]
});

grid.on('check', function (e) {
    var checkRows = grid.getCheckedRowKeys();
    checkRows.forEach(function( key, idx){                      
       if(key != e.rowKey){
          grid.uncheck(key);
       }
    });

});

function itemList(){
	$.ajax({
		url : "/itemAllList",
		method: "get",
		dataType : "json",
		success: function(result){
			grid.resetData(result);
		},
		error: function(reject){
			
		}
		
	});
}

itemList();

$('#item').on('change', function(){
	$.ajax({
		url : "/itemList",
		method: "get",
		dataType : "json",
		data :{ val : $('#item').val() },
		success: function(result){
			grid.resetData(result);
		},
		error: function(reject){
			
		}
		
	});
});

var modalGrid = new tui.Grid({
	el : document.getElementById('modalGrid'),
	columns : [ 
	{
		header : '품목코드',
		name : 'itemCode',
		width: 100

	}, {
		header : '품목명',
		name : 'itemName',
		editor: "text"
	}, {
		header : '구분',
		name : 'itemType',
		editor: {
            type: 'select',
            options: {
                listItems: [
               	 	{
                        text: '완제품',
                        value: '완제품'
                    },
                    {
                        text: '반제품',
                        value: '반제품'
                    },
                    {
                        text: '자제',
                        value: '자제'
                    }
                ]
            }
		 }
	}, {
		header : '규격',
		name : 'standard',
		editor: 'text'
	}, {
		header : '단위',
		name : 'unit',
		 editor: {
             type: 'select',
             options: {
                 listItems: [
                	 {
                         text: 'mL',
                         value: 'ml'
                     },
                     {
                         text: 'L',
                         value: 'L'
                     },
                     {
                         text: 'Kg',
                         value: 'Kg'
                     },
                     {
                         text: 'g',
                         value: 'g'
                     },
                     ,
                     {
                         text: 'EA',
                         value: 'EA'
                     }
                     ,
                     {
                         text: 'm',
                         value: 'm'
                     } ,
                     {
                         text: 'cm',
                         value: 'cm'
                     }
                 ]
             }
		 }
	},{
		header : '단가',
		name : 'unitPrice',	
		editor: 'text'
	}, {
		header : '판매가격',
		name : 'itemPrice',
		editor: 'text'
	}, {
		header : '안전재고',
		name : 'saveMaterial',
		editor: 'text'
	}
	]
});



var modModalGrid = new tui.Grid({
	el : document.getElementById('modModalGrid'),
	columns : [ 
	{
		header : '품목코드',
		name : 'itemCode',
		width: 100

	}, {
		header : '품목명',
		name : 'itemName',
		editor: "text"
	}, {
		header : '구분',
		name : 'itemType',
		editor: {
            type: 'select',
            options: {
                listItems: [
               	 	{
                        text: '완제품',
                        value: '완제품'
                    },
                    {
                        text: '반제품',
                        value: '반제품'
                    },
                    {
                        text: '자제',
                        value: '자제'
                    }
                ]
            }
		 }
	}, {
		header : '규격',
		name : 'standard',
		editor: 'text'
	}, {
		header : '단위',
		name : 'unit',
		 editor: {
             type: 'select',
             options: {
                 listItems: [
                	 {
                         text: 'mL',
                         value: 'ml'
                     },
                     {
                         text: 'L',
                         value: 'L'
                     },
                     {
                         text: 'Kg',
                         value: 'Kg'
                     },
                     {
                         text: 'g',
                         value: 'g'
                     },
                     ,
                     {
                         text: 'EA',
                         value: 'EA'
                     }
                     ,
                     {
                         text: 'm',
                         value: 'm'
                     } ,
                     {
                         text: 'cm',
                         value: 'cm'
                     }
                 ]
             }
		 }
	},{
		header : '단가',
		name : 'unitPrice',	
		editor: 'text'
	}, {
		header : '판매가격',
		name : 'itemPrice',
		editor: 'text'
	}, {
		header : '안전재고',
		name : 'saveMaterial',
		editor: 'text'
	}
	]
});

$('#addModalBtn').on('click', function() {
	$.ajax({
		url:"/getItemCode",
		method :"get",
		dataType : "json",
		success:function(result){
			console.log(result);
			modalGrid.resetData([result])
			
			$('#addModal').on('shown.bs.modal', function (e) {
				console.log('open');
				setTimeout(()=> modalGrid.refreshLayout(), 300);
			
			})
		},
		error:function(reject){
			console.log(reject);
		}
		
	})
})

$('#addBtn').on('click', function(){
	modalGrid.finishEditing();
	$.ajax({
		url : "/addItemAjax",
		contentType : "application/json",
		data : JSON.stringify(modalGrid.getData()[0]),
		method : "post",
		beforeSend: function(xhr){
			xhr.setRequestHeader(header, token);    
		},success : function(result) {
			itemList();
			$('#addModal').modal('hide');
			
		},error : function(reject) {
			console.log(reject)
		}
	})
})

$('#modModalBtn').on('click',function() {
	if(grid.getCheckedRows().length != 0 ){
		$('#modModal').modal('show');
		console.log(grid.getCheckedRows())
		modModalGrid.resetData(grid.getCheckedRows());
		$('#modModal').on('shown.bs.modal', function (e) {
			modModalGrid.refreshLayout();
		})
	}else {
		alert("아무것도 선택되지 않았습니다.");
	}
})

	
$('#modBtn').on('click', function(){
	modModalGrid.finishEditing();
	$.ajax({
		url : "/modItemAjax",
		contentType : "application/json",
		data : JSON.stringify(modModalGrid.getData()[0]),
		method : "post",
		beforeSend: function(xhr){
			xhr.setRequestHeader(header, token);    
		},success : function(result) {
			$('#addModal').modal('hide');
			itemList();

		},error : function(reject) {
			console.log(reject)
		}
	})
})


$('#delBtn').on('click', function(){
	console.log(modModalGrid.getData()[0].itemCode)
	$.ajax({
		url : "/removeItem",
		data : {itemCode : modModalGrid.getData()[0].itemCode},
		method : "get",
		success : function(result) {
			if (result = "success"){
				alert( modModalGrid.getData()[0].itemName + "을 삭제!")
				itemList();
				$('#modModal').modal('hide');
			}else {
				alert("실패!")
			}

		},error : function(reject) {
			console.log(reject)
		}
	})
})



</script>






















































































































 -->