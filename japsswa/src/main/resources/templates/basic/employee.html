<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/index}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head lang="en">
<meta charset="UTF-8">

<link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>

<th:block layout:fragment="content">
	<div class="container-fluid page-body-wrapper">
		<div class="col-12 grid-margin stretch-card">
			<div class="card">
				<div class="card-body">
					<h1 class="card-title">사원 정보</h1>
					<form id="controller">
					 	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
						<button type="button" id="modifyBtn" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#searchModal">수정</button>
						<button id="addEmpBtn">등록</button>
					</form>

					<div id="grid"></div>
					
				</div>
			</div>
		</div>
	</div>
	
	
       <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
           <div class="modal-dialog modal-dialog-centered">
           <div class="modal-content">
               <div class="modal-header">
               <h5 class="modal-title" id="searchModalLabel">사원정보 조회</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              
               </div>
               <div class="modal-body">
                <input id="empNo" name="empNo" value="ddd" readonly>
                
               </div>
               <div class="modal-footer">
               <button type="button" class="btn btn-primary">선택</button>
               </div>
           </div>
           </div>
       </div>


	<script>
		// GRID 를 생성한다.
		// 나이는 수정할 수 있도록 설정한다.
		window.onload = function() {
			$.ajax({
				url : "/employeeAjax",
				method : "GET",
				dataType : "JSON",
				success : function(result) {
					grid.resetData(result);
				}
			});

			var grid = new tui.Grid({
				el : document.getElementById('grid'),
				scrollX:true,
				scrollY:true,
				rowHeaders:['checkbox'],
				columns : [
					{
						header : 'No.',
						name : 'rownum',
						sortingType : 'desc',
						sortable : true
					},

				{
					header : '사원번호',
					name : 'empNo',
					sortingType : 'desc',
					sortable : true
				},	{
					header : '이름',
					name : 'empName',
					sortingType : 'desc',
					sortable : true
				}, {
					header : '직책',
					name : 'position',
					sortingType : 'desc',
					sortable : true, 
				}, {
					header : '부서',
					name : 'deptName',
					sortingType : 'desc',
					sortable : true
				}, {
					header : '연락처',
					name : 'phoneNum',
					sortingType : 'desc',
					sortable : true
				}, {
					header : 'e-mail',
					name : 'email',
					sortingType : 'desc',
					sortable : true
				},

				{
					header : '입사일',
					name : 'hireDate',
					sortingType : 'desc',
					sortable : true
				} ]
			});
		}
		

	</script>
	
		
	<script>
		$('#addEmpBtn').on('click', function(e){
			e.preventDefault();
			self.location = '/employee/ragister';
		})
		
		$('#modifyBtn').on('click', function(e){
			e.preventDefault();
			$('input:checkbox').each(function (index) {
				if($(this).is(":checked")==true){
			    	let checkd = $(this).parent().parent().data('row-key');
					var empNo =$('td[data-row-key='+checkd+']').children(':eq(2)').text();
					console.log(empNo);
					$('#empNo').val(empNo)
					
			    	$.ajax({
						url : "/serchEmpAjax",
						method : "GET",
						data : { empNo : $('td[data-row-key='+checkd+']').children(':eq(2)').text() },
						dateType:"JSON",
						success : function(result) {
							
							
						}
					});
			    	
			    	$('.modal').modal('show');
			    }else {

			    }
				
				
			}) 
	    	
		})
	</script>
</th:block>

</html>
