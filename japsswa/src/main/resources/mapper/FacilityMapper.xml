<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.mes.jss.facility.mapper.FacilityMapper">
  
  	<!-- 비가동 페이지 -->    	
  	
  	<select id="getList" resultType="FacilityVO">
  		SELECT	fac_name, 
  		            fac_code, 
  		            fac_manager, 
  		            fac_status, 
  		            get_fac_start_date(fac_code) as start_date
		  FROM  facility 
		ORDER  BY fac_code
  	</select>
  	
  	<select id="getdownList" resultType="DowntimeVO">  				
        select  f.fac_name,
        		  f.fac_code,
        		  d.down_code,
        		  d.stop_date,
        		  d.down_reason,
        		  d.down_manager,
        		  d.remark
		  from  facility f join downtime d 
		     on  (f.fac_code = d.fac_code)
		where  d.start_date is null
     order by fac_code
  	</select>
  	
  	<insert id="insertDownList" parameterType="DowntimeVO">  				
		insert into downtime(
			           down_code, 
			           stop_date, 
			           down_reason, 
			           down_manager, 
			           remark, 
			           fac_code)
			values  (('DOW' || lpad(downtime_seq.nextval, 4, '0')),
			           current_date , 
			           #{downReason} , 
			           #{downManager} , 
			           #{remark} , 
			           #{facCode})
  	</insert>
  	
  	<update id="updateFacStatus" parameterType="FacilityVO">
  		update facility 
  		     set 
  		          fac_status = case	when fac_status = 'Y' then 'N'
		                                    else   fac_status	end
		where fac_code = #{facCode}
  	</update>
  	
  	<update id="newUpdateFacStatus" parameterType="FacilityVO">
  		update facility 
  			set 
  		          fac_status = case  when fac_status = 'N' then 'Y'
		                             		else   fac_status	end
		where fac_code = #{facCode}
  	</update>
  	
  	<update id="insertStartTime" parameterType="DowntimeVO">
  		update downtime 
  			set 
  				  start_date = current_date 
  	     where fac_code = #{facCode}
  	</update>  	 
  	
  	<delete id="deleteDownCode">
  		delete from downtime 
  			 where 	 down_code = #{downCode}
  	</delete>
  	
  	<update id="updateDownTime" parameterType="DowntimeVO">
  		update downtime 
  			set
  		          down_reason = #{downReason} , 
  		          down_manager = #{downManager} , 
  		          remark = #{remark} 
  		 where down_code = #{downCode}
  	</update>
  	
  	<!-- 비가동 내역 페이지 -->
  	
  	<select id="getDownDetailList" resultType="DowntimeVO">
  		select  f.fac_name, 
  				  f.fac_code , 
  				  d.down_code, 
  				  d.start_date, 
  				  d.stop_date, 
  				  d.down_reason, 
  				  d.down_manager, 
  				  d.remark
		from   facility f join downtime d 
		on      (f.fac_code = d.fac_code) 
		order by down_code desc
  	</select>
  	
  	<select id="searchlist" parameterType="FacilityVO" resultType="FacilityVO">
  		select  d.down_code, 
  				  f.fac_code,
  				  f.fac_name, 
  				  d.start_date, 
  				  d.stop_date, 
  				  d.down_reason,
  				  d.down_manager, 
  				  d.remark
		from   downtime d join facility f 
		   on   (f.fac_code = d.fac_code)
		where fac_name = #{facName}
  	</select>
  	
  	<!-- 설비 페이지 -->
  	
  	<select id="getAllList" resultType="FacilityVO">
  		select fac_code, fac_name, to_char(fac_date, 'YYYY-MM-DD') as fac_date , fac_process, fac_status, wash_cycle, ins_cycle, to_char(last_inspection, 'YYYY-MM-DD') as last_inspection, fac_manager, fac_function, fac_picture
		from facility
  	</select>
  	
  	<select id="searchFac" parameterType="FacilityVO" resultType="FacilityVO">
  		select * from facility where fac_name like '%' || #{facName} || '%'
  	</select>
  	
  	<insert id="insertFacility" parameterType="FacilityVO">
  		insert into facility (fac_code , fac_name , fac_date, fac_process , fac_status,
  		wash_cycle, ins_cycle, last_inspection, fac_manager, fac_function)
        values(('FAC' || lpad(facility_seq.nextval, 4,'0')) , #{facName} , #{facDate} , #{facProcess}, #{facStatus}, 
        #{washCycle},#{insCycle}, #{lastInspection}, #{facManager}, #{facFunction})
  	</insert>
  	
  	<update id="modifyFac" parameterType="FacilityvO">
  		update facility   		
  					set
					  		fac_name = #{facName}, 
					  		fac_date = #{facDate} , 
					  		fac_process = #{facProcess},
					  		wash_cycle = #{washCycle} ,
					  		ins_cycle = #{insCycle},
					  		last_inspection = #{lastInspection}, 
					  		fac_manager = #{facManager},
					  		fac_function = #{facFunction},
							fac_picture = #{facPicture}		
  				  where  fac_code = #{facCode}
  	</update>
  	
  	<delete id="deleteFac">
  		delete from facility where fac_code = #{facCode} 
  	</delete>
  	
  	<!-- 점검 관리 페이지 -->
  	
  	<select id="getInsList" resultType="InspectionVO">
  		select * from inspection
  	</select>
  	
  	
  </mapper>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  