<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.mes.jss.facility.mapper.FacilityMapper">
  
  	<select id="getFacility" resultType="FacilityVO">
  		select * from facility where fac_code = #{facCode}
  	</select>
  	
  	<select id="getList" resultType="FacilityVO">
  		SELECT fac_name, fac_code, fac_manager, fac_status, get_fac_start_date(fac_code) as start_date
		FROM facility 
		ORDER BY fac_code
                
  	</select>
  	
  	<select id="getdownList" resultType="DowntimeVO">  				
        select f.fac_name,f.fac_code,d.down_code,d.stop_date,d.down_reason,d.down_manager,d.remark
		from facility f join downtime d 
		on(f.fac_code = d.fac_code)
		where d.start_date is null
		order by fac_code
  	</select>
  	
  	<insert id="insertDownList" parameterType="DowntimeVO">
  		insert into downtime(down_code, stop_date, down_reason, down_manager, remark, fac_code)
		values (('DOW' || lpad(downtime_seq.nextval, 4, '0')), to_date(sysdate,'yyyy/MM/dd') , 
		#{downReason} , #{downManager} , #{remark} , #{facCode})
  	</insert>
  	
  	<update id="updateFacStatus" parameterType="FacilityVO">
  		update facility set fac_status = case
		when fac_status = 'Y' then 'N'        
		else fac_status
		end
		where fac_code = #{facCode}
  	</update>
  	
  	<update id="newUpdateFacStatus" parameterType="FacilityVO">
  		update facility set fac_status = case		
        when fac_status = 'N' then 'Y'
		else fac_status
		end
		where fac_code = #{facCode}
  	</update>
  	
  	<update id="insertStartTime" parameterType="DowntimeVO">
  		update downtime set start_date = to_date(sysdate,'yyyy/MM/dd') where fac_code = #{facCode}
  	</update>
  	
  	<select id="getDownDetailList" resultType="DowntimeVO">
  		select * from downtime order by down_code desc
  	</select>
  	
  	<delete id="deleteDownCode">
  		delete from downtime where down_code = #{downCode}
  	</delete>
  	
  </mapper>