<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.mes.jss.production.mapper.PlanMapper">
  
  	<!-- 생산계획관리 페이지에서 제품별 주문수량 정보 리스트 -->
  	<select id="planOrderInfo" resultType="PlanVO">
		SELECT d.item_code, item_name, SUM(ord_count) as ordSum
		from orddetail d join itemlist i on(d.item_code = i.item_code)
		GROUP BY d.item_code, item_name, ord_count
		ORDER BY 1
  	</select>
  	
  	<select id="modalPlanList" resultType="PlanVO">
		SELECT plan_id, plan_name, e.emp_name
		FROM plan p JOIN emp e 
					ON(p.emp_no = e.emp_no)  		
  	</select>


	<select id="planSave" statementType="CALLABLE" parameterType="PlanVO" resultType="PlanVO">
	   
	   {call PLAN_INSERT(        
	           #{planName, mode=IN,  jdbcType=VARCHAR},
	           #{planDate, mode=IN,  jdbcType=VARCHAR},
	           #{empNo, mode=IN,  jdbcType=VARCHAR},
	           #{planCode, mode=INOUT,  jdbcType=VARCHAR, javaType=String}
	         )
	   }
	   
	</select> 

	<select id="commonSearchResult" resultType="PlanVO">
		select plan_name, plan_date, emp_name
		from plan p join emp e on(p.emp_no =  e.emp_no)
		where plan_id = #{planId}
	</select>
	
	<select id="detailSearchResult" resultType="PlanVO">
		select  item_name, plan_amount, plan_start, plan_end, plan_priority
		from plan_detail d join itemlist i on (d.item_code = i.item_code)
		where plan_id = #{planId}
	</select>

  	
  </mapper>